var PoiHandan = [ //图书馆 文科图书馆 第四教学楼（地图可能有更新
  // 邯郸
  {name: "图书馆",longitude: 121.50299,latitude: 31.29719,flag:0},
  {
    name: "文科图书馆",
    longitude: 121.505178,
    latitude: 31.296127,
    flag: 0,
    ques: -1
  },
  {
    name: "复旦大学邯郸校区工会女教职工委员会",
    longitude: 121.505253,
    latitude: 31.295017,
    flag: 0,
    ques: -1
  },
  {
    name: "子彬院",
    longitude: 121.500442,
    latitude: 31.297318,
    flag: 0,
    ques: -1
  },
  {//子彬院
    name: "北门",
    longitude: 121.500243,
    latitude: 31.297648,
    flag: 0,
    ques: -1
  },
  // {//逸夫楼
  //   name: "复旦大学海关史与海关文献国际研究中心",
  //   longitude: 121.501901,
  //   latitude: 31.299331,
  //   flag: 0,
  //   ques: -1
  // },
  {
    name: "逸夫楼",
    longitude: 121.501691,
    latitude: 31.299239,
    flag: 0,
    ques: -1
  },
  {
    name: "逸夫科技楼",
    longitude: 121.500758,
    latitude: 31.29818,
    flag: 0,
    ques: -1
  },
  {
    name: "综合办公楼北楼",
    longitude: 121.501981,
    latitude: 31.29692,
    flag: 0,
    ques: -1
  },
  {
    name: "综合办公楼",
    longitude: 121.501906,
    latitude: 31.296929,
    flag: 0,
    ques: -1
  },
  {
    name: "第一教学楼",
    longitude: 121.501729,
    latitude: 31.297442,
    flag: 0,
    ques: -1
  },
  {
    name: "第二教学楼",
    longitude: 121.504052,
    latitude: 31.29768,
    flag: 0,
    ques: -1
  },
  {
    name: "第三教学楼",
    longitude: 121.504384,
    latitude: 31.298116,
    flag: 0,
    ques: -1
  },
  {
    name: "青年复旦学校",
    longitude: 121.504384,
    latitude: 31.298116,
    flag: 0,
    ques: 0,
    Qs:{
      words: "期末季，三教人满为患。深夜奋笔疾书时，你发现了一个突然倒地不起的同学，此时你应该首先：（单选）",
      num: 4,
      class: 'single',
      a1: "确认现场环境安全并做好自我保护",
      a2: "轻拍高喊检查是否有意识",
      a3: "扫视法检查胸腹是否有起伏",
      a4: "直接进行心肺复苏",
      key: [1],
      solution:"正确答案：A. 确认现场环境安全并做好自我保护。\n　　当看到同学倒地需要紧急救助时，作为救助者，应当首先确认现场环境安全并做好自我保护，这是所有急救的第一步。\n　　如果同学倒地不起，应当判断其意识、呼吸，如“轻拍高喊检查是否有意识”“扫视法检查胸腹是否有起伏”。\n　　当且仅当无意识、无呼吸时，应及时呼救、拨打120，并进行心肺复苏，包括胸外按压（100-120次/min，5-6cm深）与获取最近的AED分析除颤。"
    }
  },
  {
    name: "第四教学楼",
    longitude: 121.50145, 
    latitude: 31.298451,
    flag:0,
    ques:-1
  },
  {
    name: "经济学院第五教学楼",
    longitude: 121.504615,
    latitude: 31.29554,
    flag: 0,
    ques: -1
  },
  {
    name: "经济学院第六教学楼",
    longitude: 121.504223,
    latitude: 31.29493,
    flag: 0,
    ques: -1
  },
  {
    name: "田径场",
    longitude: 121.507662,
    latitude: 31.29653,
    flag: 0,
    ques: -1
  },
  // {
  //   name: "体育教学部",
  //   longitude: 121.502437,
  //   latitude: 31.291698,
  //   flag: 0,
  //   ques: -1
  // },
  {
    name: "北看台",
    longitude: 121.502378,
    latitude: 31.291625,
    flag: 0,
    ques: -1
  },
  // {
  //   name: "西门",
  //   longitude: 121.502378,
  //   latitude: 31.291625,
  //   flag: 0,
  //   ques: -1
  // },
  {
    name: "复旦大学正大集团体育馆",
    longitude: 121.503601,
    latitude: 31.292656,
    flag: 0,
    ques: 0,
    Qs:{
      words: "秋天的第一场球赛，球友们“厮杀”地异常激烈。队友在不远处等待你的传球。不想，你在带球过人时与对方相撞，磕倒在地，牙齿有些松动但未完全断裂，此时你应进行下列哪些操作：（多选）",
      num: 6,
      class: 'multi',
      a1: "继续比赛，待结束后再查看伤势",
      a2: "若牙齿有部分断裂，则（在牛奶中）保存牙齿残片，立即就医",
      a3: "若牙齿有部分断裂，无须寻找牙齿残片，直接去往医院",
      a4: "若牙齿有部分断裂，则用餐巾纸包裹牙齿残片，去往医院",
      a5: "若牙齿无断裂，则不移动牙齿，立即就医",
      a6: "若牙齿无断裂，立即漱口后继续比赛",
      key: [2,5],
      solution:"答案：BE\n　　当体育比赛中出现任何伤情，首先需要立即暂停比赛转移伤员并检查情况；对于断裂的牙齿应保持其湿度和表面组织活性，将其放入牛奶中保存，并立即就医。\n　　“D. 若牙齿有部分断裂，则用餐巾纸包裹牙齿残片，去往医院”餐巾纸包裹不能达到好的无菌效果，同时湿度不足不利于表面生活组织维持活性；\n　　“F. 若牙齿无断裂，立即漱口后继续比赛”没有及时施救，可能错过最佳时机。"
    }
  },
  {
    name: "光华楼西主楼",
    longitude: 121.504921,
    latitude: 31.299849,
    flag: 0,
    ques: -1
  },
  {
    name: "光华楼西辅楼",
    longitude: 121.504658,
    latitude: 31.299761,
    flag: 0,
    ques: -1
  },
  {
    name: "辅楼",
    longitude: 121.506074,
    latitude: 31.300238,
    flag: 0,
    ques: -1
  },
  {name: "复旦大学(邯郸校区)光华楼东辅楼", longitude: 121.505983, latitude: 31.300234,flag:0,ques:-1},
  {
    name: "复旦大学邯郸校区光华楼西辅楼",
    longitude: 121.504577,
    latitude: 31.299807,
    flag: 0,
    ques: -1
  },
  {
    name: "光华楼",
    longitude: 121.505291,
    latitude: 31.299949,
    flag: 0,
    ques: 0,
    Qs:{
      spot:"光华楼",
      words: "早八下课，你和好朋友正在快马加鞭赶向六教的早十。突然，你的朋友脚一滑从楼梯摔了下去，只见ta捂着小腿，嗷嗷叫疼。你发现ta捂着的地方肿起一大块，还有些淤青，并未观察到出血。你又看看表，只有五分钟就要上课。此时你应该：（多选）",
      num: 5,
      class: 'multi',
      a1: "上课要紧，搀扶起ta来奔向教室，待课上完再进行处理。",
      a2: "安抚其情绪，同时让ta不要乱动，就地拨打120或寻找救护人员。",
      a3: "掏出随身携带的云南白药气雾剂，对患处进行喷药。",
      a4: "模仿曾经看到过的影视片段，尝试用祖传手法帮其正骨。",
      a5: "拿出三角巾，回忆以往所学急救知识，将其患处固定。",
      key: [2,5],
      solution:"正确答案：BE\n　　遇到猛烈冲击后四肢肿起一大块，应高度怀疑闭合性骨折。此时为防二次伤害，应立即进行伤处固定，并尽早呼救。对于固定患者的具体操作，①受训的救护员使用三角巾和夹板或替代品对患者伤处进行包扎固定，②如不了解固定方法，请不要移动患者，等待专业人员帮助。处理好患者的伤情后，做好人文关怀，安抚其情绪。\n　　A中先上课会耽误病情。\n　　C中“喷云南白药”不适用于损伤急性进展的阶段（比如刚刚摔断）。若使用云南白药活血化瘀，将扩张血管，增加出血与疼痛。正确操作为冰敷，帮助止血止痛。\n　　D中“模仿影视片段”行为并不专业，没有医学依据。"
    }
  },
  {
    name: "体育馆",
    longitude: 121.495732,
    latitude: 31.300811,
    flag: 0,
    ques: -1,
    
  },

  {
    name: "旦苑餐厅大众餐",
    longitude: 121.506723,
    latitude: 31.30104,
    flag: 0,
    ques: -1
  },
  {
    name: "复旦大学北区清真食堂",
    longitude: 121.497223,
    latitude: 31.301421,
    flag: 0,
    ques: 0,
    Qs:{
      words: "你在北食二楼正安详地自习。旁边狼吞虎咽的同学突然涨红了脸，两手呈“V”型掐住自己的脖子，并发出尖锐的声音，此时你应该：（单选）",
      num: 4,
      class: 'single',
      a1: "询问同学情况，并给同学喝水",
      a2: "认为同学只是太激动了，当作无事发生",
      a3: "询问同学是不是卡住了，并在征得同意以后实施海姆立克急救法",
      a4: "拍拍他的背，问他怎么了",
      key: [3],
      solution:"正确答案：C. 询问同学是不是卡住了，并在征得同意以后实施海姆立克急救法。\n　　当你看到同学面色发绀、做出“V”字手势、发出尖锐声音，应高度怀疑气道异物梗阻（即东西呛到气管里卡住了），并不是无事发生。此时应询问同学是不是卡住了，并在征得同意以后实施海姆立克急救法（拍背五次+腹部冲击循环，直到排出异物）。\n　　A中“给同学喝水”无法改善气道的梗阻。"
    }
  },
  {
    name: "复旦大学南区餐厅",
    longitude: 121.500259,
    latitude: 31.292028,
    flag: 0,
    ques: -1
  },
  {
    name: "复旦教工食堂",
    longitude: 121.50491,
    latitude: 31.294728,
    flag: 0,
    ques: -1
  },
  {
    name: "南苑复旦餐厅",
    longitude: 121.506122,
    latitude: 31.294105,
    flag: 0,
    ques: -1
  },
  {
    name: "相辉堂",
    longitude: 121.499449,
    latitude: 31.297479,
    flag: 0,
    ques: 0,
    Qs:{
      words: "你在相辉堂旁边逗猫，正当想摸摸ta时，ta却不领情地挠了你。猫猫虽可爱，保命更要紧。此时你更应该用以下哪种溶液冲洗伤口：（单选）",
      num: 4,
      class: 'single',
      a1: "肥皂水",
      a2: "盐水",
      a3: "清水",
      a4: "醋酸水溶液",
      key: [1],
      solution:"正确答案：A，用20%的肥皂水大量冲洗干净为宜，同时用力挤压伤口及周围皮肤，最大限度地挤出伤口内污血，以尽可能减少病毒的吸收。\n　　注意：冲洗之前不要忘记戴手套，做好自我防护；冲洗后不要包扎伤口，应立即就近就医注射狂犬病疫苗和破伤风抗毒素，注射疫苗期间严格遵照医嘱。"
    }
  },
  {
    name: "二号交叉学科楼",
    longitude: 121.509438,
    latitude: 31.340176,
    flag: 0,
    ques: -1
  },
  {
    name: "综合体育馆",
    longitude: 121.503456,
    latitude: 31.333688,
    flag: 0,
    ques: -1
  },
  {
    name: "李兆基图书馆",
    longitude: 121.507383,
    latitude: 31.337042,
    flag: 0,
    ques: -1
  },
  {
    name: "廖凯原法学楼",
    longitude: 121.505715,
    latitude: 31.337239,
    flag: 0,
    ques: -1
  },
  {
    name: "智华楼",
    longitude: 121.504336,
    latitude: 31.336667,
    flag: 0,
ques:-1
  },
  {
    name: "教学楼A",
    longitude: 121.50542,
    latitude: 31.336309,
    flag: 0,
ques:-1
  },
  {
    name: "复旦大学化学系",
    longitude: 121.511878,
    latitude: 31.340291,
    flag: 0,
ques:-1
  },
  {
    name: "复旦大学江湾校区-新能源研究院",
    longitude: 121.511841,
    latitude: 31.339365,
    flag: 0,
ques:-1
  },
  {
    name: "环境科学楼",
    longitude: 121.511111,
    latitude: 31.338541,
    flag: 0,
ques:-1
  },
  {
    name: "物理科研楼",
    longitude: 121.508139,
    latitude: 31.339017,
    flag: 0,
ques:-1
  },
  {
    name: "上海数学中心",
    longitude: 121.508601,
    latitude: 31.338247,
    flag: 0,
ques:-1
  },
  {
    name: "生命科学院",
    longitude: 121.507582,
    latitude: 31.340048,
    flag: 0,
ques:-1
  },
  {
    name: "田径场",
    longitude: 121.502539,
    latitude: 31.334655,
    flag: 0,
    ques:0,
    Qs:{
      spot:"田径场",
      words: "操场上，同学们顶着热辣的太阳正在挥洒汗水。突然，一位同学倒下了，他意识不清并恶心抽搐。此时应该：（多选）",
      num: 5,
      class: 'multi',
      a1: "找来藿香正气水使其服用",
      a2: "将患者拖到树荫底下，并解开衣物",
      a3: "尽快背着患者去医务室",
      a4: "拨打120",
      a5: "在患者身上泼洒凉水，并在腋下和颈部放置冰袋",
      key: [2,4,5],
      solution:"正确答案：BDE\n　　遇到长时间暴露于高温无遮蔽环境下的患者，应高度怀疑中暑。此时需要尽快找到阴凉的环境并帮助患者散热，①冷敷：用冰袋冷敷双侧腋下、颈动脉处及腹股沟区，②冷水擦浴全身（除胸部）；严重的需要及时就医。若患者意识清醒，可口服淡盐水。\n　　A中藿香正气水里含酒精，使人体脱水更严重，不能用于应对中暑。而且当患者无意识时，不应喂食，防止其呛咳、窒息。\n　　C中“背着患者去医务室”没有及时施救，可能错过最佳时机。"
    }
  },
  {
    name: "食堂",
    longitude: 121.504046,
    latitude: 31.335837,
    flag: 0,
    ques:0,
    Qs:{
      spot:"食堂",
      words: "江湾食堂里，你正在大快朵颐。突然见有人倒地抽搐，怀疑癫痫，此时你应该：（多选）",
      num: 4,
      class: 'multi',
      a1: "拨打120",
      a2: "用手压住患者舌头，防止窒息",
      a3: "用毛巾等物品顶住牙齿，防止其咬伤自己的舌头",
      a4: "搬开患者周围的桌椅，防止其在抽搐的时候撞伤",
      key: [1,4],
      solution:"正确答案：AD\n　　倒地抽搐是癫痫的经典表现，不要惊慌。移除周围桌椅等可能造成伤害的物体，将毛巾或衣物垫在患者头下方，以保护患者头部。\n　　不要按住患者，患者抽搐的力量很大，用力按住患者，可能会使患者肌肉拉伤，甚至骨折。\n　　不要在患者牙齿之间塞入任何东西。①癫痫发作时牙关紧闭，极难撬开，若强硬塞入易损伤牙齿，塞入的物体和脱落的牙齿则有落入咽部、气道、导致窒息的危险；②即使舌头被咬破，受伤部位一般是舌头边缘或口腔黏膜，出血量不多，并无大碍。\n　　如果持续抽搐时间超过5分钟，或反复抽搐，应拨打急救电话120。"
    }
  },
  {
    name: "复旦大学枫林综合游泳馆",
    longitude: 121.451255,
    latitude: 31.195916,
    flag: 0,
ques:-1
  },
  {
    name: "复旦大学枫林综合游泳馆",
    longitude: 121.451255,
    latitude: 31.195916,
    flag: 0,
ques:-1
  },
  {
    name: "复旦大学上海医学院(枫林路校区)西区西11号楼",
    longitude: 121.44993,
    latitude: 31.195443,
    flag: 0,
    ques:0,
    Qs:{
      spot:"复旦大学上海医学院(枫林路校区)西区西11号楼",
      words: "夜深人静，你本想冲泡一杯香浓的咖啡打算挑灯夜战；奈何手一抖，开水洒到了手上，烫的你一激灵。此时你应该：（多选）",
      num: 4,
      class: 'multi',
      a1: "用冷水冲洗10min+",
      a2: "用无菌敷料覆盖伤口",
      a3: "在烫伤的部位涂抹牙膏",
      a4: "将一袋冰块放在烫伤部位",
      key: [1, 2],
      solution:"正确答案：AB\n　　当遇到烫伤，应立即远离高温源头，注意保护创面，用冷的自来水（15～25℃）持续冲洗（或浸泡伤处）降温直至疼痛缓解（10min+为佳）。若创面被衣物覆盖，应脱去或剪去衣物。若烫伤较严重，应用无菌敷料覆盖创面，及时送医。\n　　C中“涂抹牙膏”除了暂时的清凉感觉之外，存在副作用：①阻碍体表辐射热量散发，不利于烫伤恢复；②家用牙膏中可能含有细菌，有感染风险。\n　　D中使用冰块，不仅没有保护创面，还可能造成低温冻伤。"
    }
  },
  {
    name: "康泉图书馆",
    longitude: 121.449469,
    latitude: 31.196145,
    flag: 0,
    ques:0,
    Qs:{
      words: "康泉图书馆舒适的座位上，你在学习良久后正打算拿起手机摸摸鱼。抬起头来，你却发现一个突然鼻出血的同学，此时你应该：（多选）",
      num: 4,
      class: 'multi',
      a1: "让患者坐下，身体后倾，不要让鼻血流出",
      a2: "用清洁辅料捏住鼻子两侧柔软部分，施加压力",
      a3: "观察5分钟后无法止血，应拨打120",
      a4: "如观察到同学呼吸困难，应立即拨打120",
      key: [2, 4],
      solution:"正确答案：BD\n　　当你遇到出鼻血的情况时，应让患者前倾，用清洁敷料捏住鼻子两侧柔软部分，施加压力；遇到患者呼吸困难和15分钟不止血的情况，立即拨打120。\n　　若仰头，则会导致血液倒流回鼻咽部，可能会造成误吸、呛咳，甚至窒息。"
    }
  },
//   {
//     name: "图书馆",
//     longitude: 121.449303,
//     latitude: 31.196012,
//     flag: 0,
// ques:-1
//   },
  {name: "复旦大学上海医学院枫林路校区东区明道楼", longitude: 121.452103, latitude: 31.196948,flag: 0,ques:-1},
  {name: "复旦大学(枫林校区)东区治道楼", longitude: 121.450928, latitude: 31.197894,flag: 0,ques:-1},
  {name: "复星楼", longitude: 121.45236, latitude: 31.198311,flag: 0,ques:-1},
  {name: "复旦大学上海医学院枫林路校区西区第二教学楼", longitude: 121.448487, latitude: 31.195498,flag: 0,ques:-1},
  {name: "学生体育活动中心", longitude: 121.44875, latitude: 31.196067,flag: 0,ques:-1},
  {name: "复旦大学枫林校区二号医学科研楼", longitude: 121.452865, latitude: 31.196485,flag: 0,ques:-1},
  {name: "西区停车场", longitude: 121.448541, latitude: 31.195039,flag: 0,ques:-1},
  {name: "复旦大学药理研究中心", longitude: 121.449764, latitude: 31.196788,flag: 0,ques:-1},
  {name: "西8号楼", longitude: 121.448691, latitude: 31.196471,flag: 0,ques:-1},
  {name: "上海医科大学校史馆", longitude: 121.452001, latitude: 31.197728,flag: 0,ques:-1},
  {name: "食堂", longitude: 121.596969, latitude: 31.189143,flag: 0,ques:-1},
  {name: "图书馆", longitude: 121.596985, latitude: 31.190038,flag: 0,ques:-1},
  {name: "5号楼", longitude: 121.507399, latitude: 31.298157,flag:0,ques:-1},
  {name: "复旦大学江湾新校区卫生科门诊室", longitude: 121.506348, latitude: 31.332877,flag:0,ques:-1}
];

var MediaMarker = [];
var MediaNoId = [];
var MediaNanId = [];
var MediaKongId = [];
var NanEver = 0;
var Scoretot = 0;
var Scorenow = 0;
var nowid;
// pages/map/map.js
Page({
  /**
   * 页面的初始数据
   */
  data: {
    currentTab: 0,
    jd: 121.503359,
    wd: 31.296794,
    mapheight: 445,
    mapwidth: 320,
    markers: [],
    NoId: [],
    NanId: [],
    KongId:[],
    contentNo: "点击查看题目",
    score: Scoretot,
    time: 0,
    submitwords: "请在上方填写信息，以便发放奖品。确定要提交吗？",
    pagenum:0,
    choicenum:0,
    questype:'null',
    Quesstatus:0,
    Answerstatus:0
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {
    this.mapCtx = wx.createMapContext('fdu');
    let screenHeight = wx.getSystemInfoSync().windowHeight;
    let screenWidth = wx.getSystemInfoSync().windowWidth;
    this.setData({
      mapheight: screenHeight - 37.2,
      mapwidth: screenWidth,
      maskheight: screenHeight,
      maskwidth: screenWidth,
      // boomheight: screenHeight
    });
    // // console.log(screenHeight);
    setInterval(() => {
      if(this.data.pagenum==0){
        this.setData({
         time: this.data.time+1
         });
      }
   },1000)
   MediaMarker = [];
   MediaNoId = [];
   MediaNanId = [];
   MediaKongId=[];
   Scoretot=0;
   Scorenow=0;
   NanEver=0;
  //  // console.log(PoiHandan[0].flag)
  //  // console.log(Inva[0].flag)
  //  PoiHandan = Inva;
  for(var i=0;i<PoiHandan.length;i++){
    PoiHandan[i].flag=0;
  }
  //  // console.log(PoiHandan[0].flag)
  //  // console.log("re")
   this.setData({
     // pagenum:2,
     // submitwords: "提交成功！您的积分为：" + Scoretot+",用时为"+this.data.time+"s",
     markers: MediaMarker,
     NoId: MediaNoId,
     KongId:MediaKongId,
     NanId:MediaNanId,
     time:0
   });
  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {
    MediaMarker = [];
    MediaNoId = [];
    MediaNanId = [];
    MediaKongId=[];
    this.setData({
      // pagenum:2,
      // submitwords: "提交成功！您的积分为：" + Scoretot+",用时为"+this.data.time+"s",
      markers: MediaMarker,
      NoId: MediaNoId,
      KongId:MediaKongId,
      NanId:MediaNanId,
      time:0
    });
  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  },
  /** 
   * 点击tab切换 
   */
  swichNav: function (e) {
    var that = this;
    that.setData({
      currentTab: e.target.dataset.current,
      jd: e.target.dataset.jd,
      wd: e.target.dataset.wd
    });
  },
  mapclick: function (e) {
    var i = 0;
    var found = 0;
    // var ever = 0;
    // // console.log(e.detail);
    for (i = 0; i < MediaMarker.length; i++) {
      if (e.detail.longitude == MediaMarker[i].longitude && e.detail.latitude == MediaMarker[i].latitude) return;
      else continue;
    }
    // // console.log("clicked and no ever")
    var aedscore = 5;
    for (i = 0; i < PoiHandan.length; i++) {
      // // console.log(PoiHandan[i])
      // // console.log(Math.abs(e.detail.latitude-PoiHandan[i].latitude))
      // // console.log(Math.abs(e.detail.longitude-PoiHandan[i].longitude))
      // // console.log(PoiHandan[i].flag)
      if (e.detail.name==PoiHandan[i].name&&Math.abs(e.detail.latitude-PoiHandan[i].latitude)<0.001 && Math.abs(e.detail.longitude-PoiHandan[i].longitude)<0.001&& PoiHandan[i].flag == 0) {
        PoiHandan[i].flag = 1;
        Scoretot = Number(Scoretot) + Number(aedscore);
        this.setData({
          score: Scoretot
        });
        if(PoiHandan[i].ques==0){
          MediaNoId.push(i); //把地点在handan数组中的编号ipush到NoId数组里
          MediaMarker.push({
            id: i, //marker的id就是i
            iconPath: '../../img/AED.png',
            width: 50,
            height: 50,
            latitude: e.detail.latitude,
            longitude: e.detail.longitude,
            customCallout: {
              display: "ALWAYS",
              anchorX: 0,
              anchorY: 0
            }
          });
          this.setData({
            markers: MediaMarker,
            NoId: MediaNoId,
          });
        }
        else{
          MediaKongId.push(i);
          MediaMarker.push({
            id: i, //marker的id就是i
            iconPath: '../../img/AED.png',
            width: 50,
            height: 50,
            latitude: e.detail.latitude,
            longitude: e.detail.longitude,
            customCallout: {
              display: "ALWAYS",
              anchorX: 0,
              anchorY: 0
            }
          });
          this.setData({
            markers: MediaMarker,
            KongId: MediaKongId,
            // content:"没有"
          });
          setTimeout(() => {
            var j=0;
            for (j = 0; j < MediaMarker.length; j++) {
              // console.log(MediaMarker[j].id)
              if (MediaMarker[j].id == i){
                var temp = MediaMarker[j];
                MediaMarker[j] = {
                  id: temp.id, //marker的id就是i
                  iconPath: '../../img/AED.png',
                  width: 50,
                  height: 50,
                  latitude: temp.latitude,
                  longitude: temp.longitude
                }
              }
            }
            for (j = 0; j < MediaKongId.length; j++) {
              // console.log(MediaKongId[j]);
              if (MediaKongId[j] == i) MediaKongId.splice(j, 1);
            }
            this.setData({
              markers: MediaMarker,
              KongId: MediaKongId,
              // content:"没有"
            });
            // console.log("clear kong")
          }, 500)
        }
        found = 1;
        // console.log("mark handan");
        break;
      }
    }
    if (found == 0) {
      NanEver++;
      var I = -NanEver;
      MediaNanId.push(I);
      MediaMarker.push({
        id: I, //id为已有空地点数的负值
        iconPath: '../../img/icon.png',
        width: 30,
        height: 30,
        latitude: e.detail.latitude,
        longitude: e.detail.longitude,
        customCallout: {
          display: "ALWAYS",
          anchorX: 0,
          anchorY: 0
        }
      });
      this.setData({
        markers: MediaMarker,
        NanId: MediaNanId,
        // content:"没有"
      });
      // console.log("mark nan");
      setTimeout(() => {
        for (i = 0; i < MediaMarker.length; i++) {
          if (MediaMarker[i].id == I) MediaMarker.splice(i, 1);
          // found = 1;
        }
        for (i = 0; i < MediaNanId.length; i++) {
          // // console.log("delete nan",MediaNanId[i]);
          if (MediaNanId[i] == I) MediaNanId.splice(i, 1);
        }
        this.setData({
          markers: MediaMarker,
          NanId: MediaNanId,
          // content:"没有"
        });
      }, 500)
      // // console.log(this.data.markers);
      // // console.log(this.data.NoId);
    }
  },
  /**
   * 弹窗
   */
  showDialogBtn: function (e) {
    var i = 0;
    if (e.detail.markerId >= 0&&PoiHandan[e.detail.markerId].ques==0) {
      // console.log("handan and tanchuang");
      nowid = e.detail.markerId;

      this.setData({
        questype: PoiHandan[e.detail.markerId].Qs.class,
        Quesstatus:1,
        Answerstatus:0,
        choicenum:PoiHandan[e.detail.markerId].Qs.num,
        question: PoiHandan[e.detail.markerId].Qs.words,
        key:PoiHandan[e.detail.markerId].Qs.key,
        answer1: PoiHandan[e.detail.markerId].Qs.a1,
        answer2: PoiHandan[e.detail.markerId].Qs.a2,
        answer3: PoiHandan[e.detail.markerId].Qs.a3,
        answer4: PoiHandan[e.detail.markerId].Qs.a4,
        solution:PoiHandan[e.detail.markerId].Qs.solution
      });
      if(PoiHandan[e.detail.markerId].Qs.num==5){
        this.setData({
          answer5: PoiHandan[e.detail.markerId].Qs.a5
        });
      }
      else if(PoiHandan[e.detail.markerId].Qs.num==6){
        this.setData({
          answer5: PoiHandan[e.detail.markerId].Qs.a5,
          answer6: PoiHandan[e.detail.markerId].Qs.a6
        });
      }
      else if(PoiHandan[e.detail.markerId].Qs.num==8){
        this.setData({
          answer5: PoiHandan[e.detail.markerId].Qs.a5,
          answer6: PoiHandan[e.detail.markerId].Qs.a6,
          answer7: PoiHandan[e.detail.markerId].Qs.a7,
          answer8: PoiHandan[e.detail.markerId].Qs.a8,
        });
      }
    }
  },
  /**
   * 弹出框蒙层截断touchmove事件
   */
  preventTouchMove: function () {},
  /**
   * 隐藏模态对话框
   */
  hideModal: function () {
    this.setData({
      questype: 'null',
      choicenum:0,
      Quesstatus:0,
      Answerstatus:0
      // isshow:true
    });
  },
  /**
   * 对话框取消按钮点击事件
   */
  onCancel: function () {
    this.hideModal();
  },
  /**
   * 对话框确认按钮点击事件
   */
  onConfirm: function () {
    if(this.data.Quesstatus==1){
      var i = 0;
      for (i = 0; i < MediaMarker.length; i++) {
        if (MediaMarker[i].id == nowid) {
          var temp = MediaMarker[i];
          MediaMarker[i] = {
            id: temp.id, //marker的id就是i
            iconPath: '../../img/AED.png',
            width: 50,
            height: 50,
            latitude: temp.latitude,
            longitude: temp.longitude
          }
        }
      }
      Scoretot = Number(Scoretot) + Number(Scorenow);
      Scorenow = 0;
      // console.log(Scoretot);
      this.setData({
        score: Scoretot,
        markers: MediaMarker,
        Quesstatus:0,
        Answerstatus:1
      });
    }
    else if(this.data.Answerstatus==1){
      this.setData({
        score: Scoretot,
        markers: MediaMarker,
        Quesstatus:0,
        Answerstatus:0
      });
      this.hideModal();
    }
  },
  singleChange(e) {
    // console.log(e.detail.value)
    // console.log(this.data.key[0])
    Scorenow = Number(e.detail.value==this.data.key[0]) * 10;
  },
  multiChange(e){
    // console.log(e.detail.value);
    // console.log(this.data.key)
    if(e.detail.value.length!=0){
      var now = e.detail.value.sort();
      var num = 0;
      var found = 0;
      for(var i = 0;i<now.length;i++){
        found = 0;
        for(var j = 0;j<this.data.key.length;j++){
          if(now[i]==this.data.key[j]){
            found = 1;
            break;
          }
        }
        if(found==1){
          num++;
          // console.log("1zhengque")
        }
        else{
          num = 0;
          break;
        }
      }
      // console.log(num)
      if(num == 0) Scorenow = 0;
      else if(num == this.data.key.length) Scorenow = 15;
      else Scorenow = 10;
      // console.log(Scorenow)
    }
  },
  showDialogBtn1: function (e) {
    this.setData({
      pagenum:1, //在这个参数上做文章 设置什么时候该出现什么样的弹
      submitwords:"确定要提交吗？"
    });
  },
  /**
   * 隐藏模态对话框
   */
  hideModal1: function () {
    this.setData({
      pagenum:0
      // isshow:true
    });
  },
  /**
   * 对话框取消按钮点击事件
   */
  onCancel1: function () {
    this.hideModal1();
  },
  /**
   * 对话框确认按钮点击事件
   */
  onConfirm1: function () {
    // this.hideModal1();
    const db = wx.cloud.database({});
    const cont = db.collection('user');
    cont.add({
      data: {
        score:Scoretot,
        time:this.data.time
      }
    });

    MediaMarker = [];
    MediaNoId = [];
    MediaNanId = [];
    MediaKongId=[];
    this.setData({
      pagenum:2,
      submitwords: "提交成功！\n您的积分为：" + Scoretot+"，\n 用时为"+this.data.time+"s。\n\n",
      markers: MediaMarker,
      NoId: MediaNoId,
      KongId:MediaKongId,
      NanId:MediaNanId,
      time:0
    });
    // this.showDialogBtn2();
    // this.hideModal1();
  },
  changetostdmap:function(){
    wx.redirectTo({
      url: '../stdmap/stdmap',
    })
  }
})